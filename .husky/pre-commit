#!/bin/sh
. "$(dirname -- "$0")/_/husky.sh"

# æ£€æŸ¥ä»£ç æ ¼å¼
echo "ğŸ” æ£€æŸ¥ä»£ç æ ¼å¼..."
npx prettier --check .
if [ $? -ne 0 ]; then
  echo "âŒ ä»£ç æ ¼å¼ä¸ç¬¦åˆè§„èŒƒï¼Œè¯·è¿è¡Œ 'npx prettier --write .' ä¿®å¤æ ¼å¼é—®é¢˜"
  exit 1
fi

# æ£€æŸ¥ä»£ç è§„èŒƒ
echo "ğŸ” æ£€æŸ¥ä»£ç è§„èŒƒ..."
npx eslint --max-warnings=0 .
if [ $? -ne 0 ]; then
  echo "âŒ ä»£ç è§„èŒƒä¸ç¬¦åˆè§„èŒƒï¼Œè¯·ä¿®å¤ä»£ç è§„èŒƒé—®é¢˜"
  exit 1
fi

# æ£€æŸ¥ TypeScript ç±»å‹
echo "ğŸ” æ£€æŸ¥ TypeScript ç±»å‹..."
npx tsc --noEmit
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript ç±»å‹æ£€æŸ¥å¤±è´¥ï¼Œè¯·ä¿®å¤ç±»å‹é”™è¯¯"
  exit 1
fi

# è¿è¡Œæµ‹è¯•
echo "ğŸ” è¿è¡Œæµ‹è¯•..."
npx vitest run --passWithNoTests
if [ $? -ne 0 ]; then
  echo "âŒ æµ‹è¯•å¤±è´¥ï¼Œè¯·ä¿®å¤æµ‹è¯•é—®é¢˜"
  exit 1
fi

echo "âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼Œå¯ä»¥æäº¤ä»£ç "
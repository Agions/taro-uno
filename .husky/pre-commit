#!/bin/sh
. "$(dirname -- "$0")/_/husky.sh"

# 检查代码格式
echo "🔍 检查代码格式..."
npx prettier --check .
if [ $? -ne 0 ]; then
  echo "❌ 代码格式不符合规范，请运行 'npx prettier --write .' 修复格式问题"
  exit 1
fi

# 检查代码规范
echo "🔍 检查代码规范..."
npx eslint --max-warnings=0 .
if [ $? -ne 0 ]; then
  echo "❌ 代码规范不符合规范，请修复代码规范问题"
  exit 1
fi

# 检查 TypeScript 类型
echo "🔍 检查 TypeScript 类型..."
npx tsc --noEmit
if [ $? -ne 0 ]; then
  echo "❌ TypeScript 类型检查失败，请修复类型错误"
  exit 1
fi

# 运行测试
echo "🔍 运行测试..."
npx vitest run --passWithNoTests
if [ $? -ne 0 ]; then
  echo "❌ 测试失败，请修复测试问题"
  exit 1
fi

echo "✅ 所有检查通过，可以提交代码"
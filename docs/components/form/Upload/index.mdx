# Upload ä¸Šä¼ ç»„ä»¶

Upload ç»„ä»¶æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æ–‡ä»¶ä¸Šä¼ ç»„ä»¶ï¼Œæ”¯æŒå¤šç§ä¸Šä¼ æ–¹å¼å’Œæ–‡ä»¶ç®¡ç†åŠŸèƒ½ï¼Œé€‚ç”¨äºå„ç§æ–‡ä»¶ä¸Šä¼ åœºæ™¯ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ“ **åŸºç¡€ä¸Šä¼ **ï¼šæ”¯æŒå•æ–‡ä»¶å’Œå¤šæ–‡ä»¶ä¸Šä¼ 
- ğŸ¯ **æ–‡ä»¶éªŒè¯**ï¼šæ”¯æŒæ–‡ä»¶ç±»å‹ã€å¤§å°ã€æ•°é‡é™åˆ¶
- ğŸ–¼ï¸ **åˆ—è¡¨å±•ç¤º**ï¼šæ”¯æŒæ–‡æœ¬ã€å›¾ç‰‡ã€å›¾ç‰‡å¡ç‰‡ç­‰å¤šç§å±•ç¤ºæ–¹å¼
- ğŸ–±ï¸ **æ‹–æ‹½ä¸Šä¼ **ï¼šæ”¯æŒæ‹–æ‹½æ–‡ä»¶åˆ°æŒ‡å®šåŒºåŸŸä¸Šä¼ 
- ğŸ¨ **è‡ªå®šä¹‰æ ·å¼**ï¼šæ”¯æŒè‡ªå®šä¹‰ä¸Šä¼ æŒ‰é’®å’Œæ–‡ä»¶åˆ—è¡¨
- ğŸ”„ **è¿›åº¦åé¦ˆ**ï¼šæ”¯æŒä¸Šä¼ è¿›åº¦æ˜¾ç¤º
- ğŸ¯ **äº‹ä»¶å›è°ƒ**ï¼šæä¾›å®Œæ•´çš„ä¸Šä¼ ç”Ÿå‘½å‘¨æœŸäº‹ä»¶
- ğŸ’ª **è‡ªå®šä¹‰ä¸Šä¼ **ï¼šæ”¯æŒè‡ªå®šä¹‰ä¸Šä¼ é€»è¾‘
- â™¿ **æ— éšœç¢æ”¯æŒ**ï¼šç¬¦åˆæ— éšœç¢è®¾è®¡æ ‡å‡†

## åŸºæœ¬ç”¨æ³•

ä¸‹é¢æ˜¯ Upload ç»„ä»¶çš„åŸºæœ¬ç”¨æ³•ç¤ºä¾‹ï¼š

```tsx
import React, { useState } from 'react';
import { View } from '@tarojs/components';
import { Upload } from '@taro-uno/components';

const BasicUpload = () => {
  const [fileList, setFileList] = useState([]);

  const handleChange = (files) => {
    setFileList(files);
  };

  return (
    <View>
      <Upload
        fileList={fileList}
        onChange={handleChange}
        action="/upload"
      />
    </View>
  );
};

export default BasicUpload;
```

## ä½¿ç”¨ç¤ºä¾‹

### 1. åŸºç¡€ä¸Šä¼ 

```tsx
import React, { useState } from 'react';
import { View } from '@tarojs/components';
import { Upload } from '@taro-uno/components';

const BasicUploadExample = () => {
  const [fileList, setFileList] = useState([]);

  const handleChange = (files) => {
    setFileList(files);
  };

  return (
    <View>
      <Upload
        fileList={fileList}
        onChange={handleChange}
        action="/upload"
      />
    </View>
  );
};

export default BasicUploadExample;
```

### 2. å¤šé€‰ä¸Šä¼ 

```tsx
import React, { useState } from 'react';
import { View } from '@tarojs/components';
import { Upload } from '@taro-uno/components';

const MultipleUploadExample = () => {
  const [fileList, setFileList] = useState([]);

  const handleChange = (files) => {
    setFileList(files);
  };

  return (
    <View>
      <Upload
        multiple
        fileList={fileList}
        onChange={handleChange}
        action="/upload"
      />
    </View>
  );
};

export default MultipleUploadExample;
```

### 3. æ–‡ä»¶éªŒè¯

```tsx
import React, { useState } from 'react';
import { View } from '@tarojs/components';
import { Upload } from '@taro-uno/components';

const ValidationUploadExample = () => {
  const [fileList, setFileList] = useState([]);

  const handleChange = (files) => {
    setFileList(files);
  };

  const handleError = (error, file) => {
    console.error(`Upload failed for ${file.name}:`, error);
  };

  return (
    <View>
      <Upload
        accept=".jpg,.jpeg,.png"
        maxSize={5 * 1024 * 1024} // 5MB
        maxCount={3}
        fileList={fileList}
        onChange={handleChange}
        onError={handleError}
        action="/upload"
      />
    </View>
  );
};

export default ValidationUploadExample;
```

### 4. æ‹–æ‹½ä¸Šä¼ 

```tsx
import React, { useState } from 'react';
import { View } from '@tarojs/components';
import { Upload } from '@taro-uno/components';

const DragUploadExample = () => {
  const [fileList, setFileList] = useState([]);

  const handleChange = (files) => {
    setFileList(files);
  };

  return (
    <View>
      <Upload
        drag
        fileList={fileList}
        onChange={handleChange}
        action="/upload"
      />
    </View>
  );
};

export default DragUploadExample;
```

### 5. è‡ªå®šä¹‰ä¸Šä¼ æŒ‰é’®

```tsx
import React, { useState } from 'react';
import { View } from '@tarojs/components';
import { Upload, Button } from '@taro-uno/components';

const CustomButtonUploadExample = () => {
  const [fileList, setFileList] = useState([]);

  const handleChange = (files) => {
    setFileList(files);
  };

  return (
    <View>
      <Upload
        fileList={fileList}
        onChange={handleChange}
        action="/upload"
      >
        <Button type="primary">ç‚¹å‡»ä¸Šä¼ </Button>
      </Upload>
    </View>
  );
};

export default CustomButtonUploadExample;
```

### 6. è‡ªå®šä¹‰ä¸Šä¼ è¯·æ±‚

```tsx
import React, { useState } from 'react';
import { View } from '@tarojs/components';
import { Upload } from '@taro-uno/components';

const CustomRequestUploadExample = () => {
  const [fileList, setFileList] = useState([]);

  const handleChange = (files) => {
    setFileList(files);
  };

  const customRequest = async (options) => {
    const { file, onProgress, onSuccess, onError } = options;
    
    // æ¨¡æ‹Ÿä¸Šä¼ è¿›åº¦
    for (let percent = 0; percent <= 100; percent += 10) {
      onProgress(percent);
      await new Promise(resolve => setTimeout(resolve, 100));
    }
    
    // æ¨¡æ‹Ÿä¸Šä¼ æˆåŠŸ
    onSuccess({ success: true, url: 'https://example.com/file.jpg' });
  };

  return (
    <View>
      <Upload
        fileList={fileList}
        onChange={handleChange}
        customRequest={customRequest}
      />
    </View>
  );
};

export default CustomRequestUploadExample;
```

### 7. å›¾ç‰‡åˆ—è¡¨å±•ç¤º

```tsx
import React, { useState } from 'react';
import { View } from '@tarojs/components';
import { Upload } from '@taro-uno/components';

const PictureUploadExample = () => {
  const [fileList, setFileList] = useState([]);

  const handleChange = (files) => {
    setFileList(files);
  };

  const handlePreview = (file) => {
    console.log('Preview file:', file);
  };

  return (
    <View>
      <Upload
        accept="image/*"
        listType="picture"
        fileList={fileList}
        onChange={handleChange}
        onPreview={handlePreview}
        action="/upload"
      />
    </View>
  );
};

export default PictureUploadExample;
```

### 8. ç¦ç”¨ä¸Šä¼ 

```tsx
import React, { useState } from 'react';
import { View } from '@tarojs/components';
import { Upload } from '@taro-uno/components';

const DisabledUploadExample = () => {
  const [fileList, setFileList] = useState([]);

  const handleChange = (files) => {
    setFileList(files);
  };

  return (
    <View>
      <Upload
        disabled
        fileList={fileList}
        onChange={handleChange}
        action="/upload"
      />
    </View>
  );
};

export default DisabledUploadExample;
```

## API

### UploadProps

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| --- | --- | --- | --- |
| accept | `string` | - | æ¥å—çš„æ–‡ä»¶ç±»å‹ |
| multiple | `boolean` | `false` | æ˜¯å¦æ”¯æŒå¤šé€‰ |
| disabled | `boolean` | `false` | æ˜¯å¦ç¦ç”¨ |
| maxCount | `number` | - | æœ€å¤§æ–‡ä»¶æ•°é‡ |
| maxSize | `number` | - | æœ€å¤§æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰ |
| fileList | `UploadFile[]` | - | æ–‡ä»¶åˆ—è¡¨ |
| defaultFileList | `UploadFile[]` | `[]` | é»˜è®¤æ–‡ä»¶åˆ—è¡¨ |
| action | `string` | - | ä¸Šä¼ åœ°å€ |
| headers | `Record<string, string>` | `{}` | è¯·æ±‚å¤´ |
| withCredentials | `boolean` | `false` | æ˜¯å¦æºå¸¦cookie |
| beforeUpload | `(file: File) => Promise<boolean \| File> \| boolean \| File` | - | ä¸Šä¼ å‰çš„é’©å­ |
| customRequest | `(options: UploadRequestOptions) => Promise<void>` | - | è‡ªå®šä¹‰ä¸Šä¼ æ–¹æ³• |
| onChange | `(fileList: UploadFile[]) => void` | - | æ–‡ä»¶çŠ¶æ€æ”¹å˜çš„å›è°ƒ |
| onRemove | `(file: UploadFile) => void` | - | ç§»é™¤æ–‡ä»¶çš„å›è°ƒ |
| onPreview | `(file: UploadFile) => void` | - | é¢„è§ˆæ–‡ä»¶çš„å›è°ƒ |
| onSuccess | `(response: any, file: File) => void` | - | ä¸Šä¼ æˆåŠŸçš„å›è°ƒ |
| onError | `(error: Error, file: File) => void` | - | ä¸Šä¼ å¤±è´¥çš„å›è°ƒ |
| onProgress | `(percent: number, file: File) => void` | - | ä¸Šä¼ è¿›åº¦çš„å›è°ƒ |
| showUploadList | `boolean` | `true` | æ˜¯å¦æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨ |
| listType | `'text' \| 'picture' \| 'picture-card'` | `'text'` | åˆ—è¡¨æ ·å¼ |
| drag | `boolean` | `false` | æ˜¯å¦æ”¯æŒæ‹–æ‹½ |
| children | `React.ReactNode` | - | è‡ªå®šä¹‰æŒ‰é’®å†…å®¹ |
| className | `string` | - | è‡ªå®šä¹‰æ ·å¼ç±»å |
| style | `React.CSSProperties` | - | è‡ªå®šä¹‰æ ·å¼ |
| accessible | `boolean` | `true` | æ— éšœç¢è®¿é—® |
| accessibilityLabel | `string` | - | æ— éšœç¢æ ‡ç­¾ |
| accessibilityRole | `string` | `'button'` | æ— éšœç¢è§’è‰² |
| accessibilityState | `{ disabled?: boolean; readonly?: boolean; busy?: boolean; selected?: boolean; }` | - | æ— éšœç¢çŠ¶æ€ |

### UploadRef

| æ–¹æ³• | ç±»å‹ | è¯´æ˜ |
| --- | --- | --- |
| getFileList | `() => UploadFile[]` | è·å–æ–‡ä»¶åˆ—è¡¨ |
| clearFileList | `() => void` | æ¸…ç©ºæ–‡ä»¶åˆ—è¡¨ |
| upload | `(file: File) => void` | ä¸Šä¼ æ–‡ä»¶ |
| abort | `(file: UploadFile) => void` | ä¸­æ­¢ä¸Šä¼  |

### UploadFile

| å±æ€§ | ç±»å‹ | è¯´æ˜ |
| --- | --- | --- |
| uid | `string` | æ–‡ä»¶å”¯ä¸€æ ‡è¯† |
| name | `string` | æ–‡ä»¶å |
| size | `number` | æ–‡ä»¶å¤§å° |
| type | `string` | æ–‡ä»¶ç±»å‹ |
| status | `'ready' \| 'uploading' \| 'done' \| 'error' \| 'removed'` | æ–‡ä»¶çŠ¶æ€ |
| percent | `number` | ä¸Šä¼ è¿›åº¦ |
| response | `any` | æœåŠ¡å™¨å“åº” |
| error | `Error` | é”™è¯¯ä¿¡æ¯ |
| originFileObj | `File` | åŸå§‹æ–‡ä»¶å¯¹è±¡ |
| url | `string` | æ–‡ä»¶URL |
| thumbUrl | `string` | é¢„è§ˆURL |

### UploadRequestOptions

| å±æ€§ | ç±»å‹ | è¯´æ˜ |
| --- | --- | --- |
| file | `File` | æ–‡ä»¶å¯¹è±¡ |
| filename | `string` | æ–‡ä»¶å |
| data | `Record<string, any>` | é™„åŠ æ•°æ® |
| headers | `Record<string, string>` | è¯·æ±‚å¤´ |
| withCredentials | `boolean` | æ˜¯å¦æºå¸¦cookie |
| action | `string` | ä¸Šä¼ åœ°å€ |
| onProgress | `(percent: number) => void` | è¿›åº¦å›è°ƒ |
| onSuccess | `(response: any) => void` | æˆåŠŸå›è°ƒ |
| onError | `(error: Error) => void` | å¤±è´¥å›è°ƒ |

### UploadUtils

| æ–¹æ³• | ç±»å‹ | è¯´æ˜ |
| --- | --- | --- |
| formatFileSize | `(bytes: number) => string` | æ ¼å¼åŒ–æ–‡ä»¶å¤§å° |
| getFileExtension | `(filename: string) => string` | è·å–æ–‡ä»¶æ‰©å±•å |
| checkFileType | `(file: File, accept: string) => boolean` | æ£€æŸ¥æ–‡ä»¶ç±»å‹ |
| checkFileSize | `(file: File, maxSize: number) => boolean` | æ£€æŸ¥æ–‡ä»¶å¤§å° |
| generatePreviewUrl | `(file: File) => Promise<string>` | ç”Ÿæˆæ–‡ä»¶é¢„è§ˆURL |

## ä½¿ç”¨æç¤º

1. **å—æ§ä¸éå—æ§æ¨¡å¼**ï¼šUpload ç»„ä»¶æ”¯æŒå—æ§å’Œéå—æ§ä¸¤ç§æ¨¡å¼ï¼Œé€šè¿‡ `fileList` å’Œ `defaultFileList` åŒºåˆ†ã€‚

2. **æ–‡ä»¶éªŒè¯**ï¼šä½¿ç”¨ `accept`ã€`maxSize` å’Œ `maxCount` å¯ä»¥é™åˆ¶æ–‡ä»¶çš„ç±»å‹ã€å¤§å°å’Œæ•°é‡ã€‚

3. **è‡ªå®šä¹‰ä¸Šä¼ **ï¼šé€šè¿‡ `customRequest` å¯ä»¥å®ç°å®Œå…¨è‡ªå®šä¹‰çš„ä¸Šä¼ é€»è¾‘ï¼Œé€‚ç”¨äºéœ€è¦ç‰¹æ®Šå¤„ç†çš„åœºæ™¯ã€‚

4. **è¿›åº¦åé¦ˆ**ï¼š`onProgress` å›è°ƒå¯ä»¥è·å–ä¸Šä¼ è¿›åº¦ï¼Œç”¨äºæ˜¾ç¤ºè¿›åº¦æ¡æˆ–å…¶ä»–è¿›åº¦æŒ‡ç¤ºå™¨ã€‚

5. **æ‹–æ‹½ä¸Šä¼ **ï¼šè®¾ç½® `drag` ä¸º `true` å¯ä»¥å¯ç”¨æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚

6. **æ–‡ä»¶é¢„è§ˆ**ï¼š`onPreview` å›è°ƒå¯ä»¥ç”¨äºå®ç°æ–‡ä»¶é¢„è§ˆåŠŸèƒ½ï¼Œç»“åˆ `UploadUtils.generatePreviewUrl` å¯ä»¥ç”Ÿæˆå›¾ç‰‡é¢„è§ˆã€‚

## æµè§ˆå™¨å…¼å®¹æ€§

| æµè§ˆå™¨ | ç‰ˆæœ¬ | æ”¯æŒæƒ…å†µ |
| --- | --- | --- |
| Chrome | 90+ | âœ… æ”¯æŒ |
| Firefox | 88+ | âœ… æ”¯æŒ |
| Safari | 14+ | âœ… æ”¯æŒ |
| Edge | 90+ | âœ… æ”¯æŒ |
| Taro H5 | 3.2+ | âœ… æ”¯æŒ |
| Taro React Native | 3.2+ | âœ… æ”¯æŒ |
| Taro å¾®ä¿¡å°ç¨‹åº | 2.16+ | âœ… æ”¯æŒ |
| Taro æ”¯ä»˜å®å°ç¨‹åº | 1.2+ | âœ… æ”¯æŒ |
| Taro ç™¾åº¦å°ç¨‹åº | 3.160+ | âœ… æ”¯æŒ |
| Taro æŠ–éŸ³å°ç¨‹åº | 2.0+ | âœ… æ”¯æŒ |

## æ— éšœç¢æ”¯æŒ

- **ARIAå±æ€§**ï¼šæ”¯æŒ `aria-label`ã€`aria-role` å’Œ `aria-state` ç­‰ARIAå±æ€§
- **é”®ç›˜å¯¼èˆª**ï¼šæ”¯æŒé€šè¿‡Tabé”®èšç„¦ï¼ŒEnter/Spaceé”®è§¦å‘ä¸Šä¼ 
- **å±å¹•é˜…è¯»å™¨**ï¼šæ”¯æŒå±å¹•é˜…è¯»å™¨è¯»å–ä¸Šä¼ æŒ‰é’®å’Œæ–‡ä»¶åˆ—è¡¨ä¿¡æ¯
- **çŠ¶æ€åé¦ˆ**ï¼šä¸Šä¼ è¿›åº¦ã€æˆåŠŸ/å¤±è´¥çŠ¶æ€ç­‰éƒ½æœ‰ç›¸åº”çš„æ— éšœç¢åé¦ˆ